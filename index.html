<!DOCTYPE html>
<meta charset="utf-8">
<script type="text/javascript" src="lib/d3.v5.min.js"></script>
<head>
  <style>

path {
  stroke: black;
  stroke-width: 2;
  fill: none;
}

@media print {
    .pagebreak { page-break-before: always; } /* page-break-after works, as well */
}

  </style>

</head>

<body>

<div id="chart1">
<script>
//-----------------------------   FIRST LINE CHART  -----------------------------//

//-----------------------------SVG------------------------------//
var margins = {top: 30, right: 20, bottom: 30, left: 60}

var svg_width = 960 - margins.left - margins.right;
var svg_height = 500 - margins.top - margins.bottom;

// we are appending SVG first
var svg = d3.select("body").append("svg")
        .attr("width",svg_width + margins.left*3 + margins.right*3)
        .attr("height" , svg_height + margins.top + margins.bottom)
        .append('g')
        .attr('transform', 'translate(' + (margins.left) + ',' + margins.top + ')');

// GETTING THE DATA

var parseTime = d3.timeParse("%m/%d/%Y");
var formatTime = d3.timeFormat("%b %y");
var dataset = d3.csv("boardgame_ratings.csv");

dataset.then(function(data) {
    var slices = data.columns.slice(1).map(function(id) {
        return {
            id: id,
            values: data.map(function(d){
                return {
                    date: parseTime(d.date),
                    measurement: +d[id]
                };
            })
        };
    });


  // Keeping only the count columns for the first line chart
tokeep = ['Catan=count','Dominion=count','Codenames=count','Terraforming Mars=count','Gloomhaven=count','Magic: The Gathering=count','Dixit=count','Monopoly=count']
var columns_a = slices.filter(function(c){
  return tokeep.indexOf(c.id) >=0
});

    // Modifying the names to remove "=count" from the columns
columns_a.forEach(function(d) {
  d.id = d.id.substring(0,d.id.indexOf("="))
})

//----------------------------SCALES----------------------------//
var xScale = d3.scaleTime().range([0,svg_width]);
var yScale = d3.scaleLinear().rangeRound([svg_height, 0]);

xScale.domain(d3.extent(data, function(d){
    return parseTime(d.date)}));

yScale.domain([(0), d3.max(columns_a, function(c) {
    return d3.max(c.values, function(d) {
        return d.measurement ; });
        })
    ]);

//-----------------------------AXES-----------------------------//
var yaxis = d3.axisLeft()
    .scale(yScale);

var xaxis = d3.axisBottom()
    .tickFormat(d3.timeFormat("%b %y"))
    .scale(xScale);

//----------------------------LINES-----------------------------//
var line = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.measurement); })
    .curve(d3.curveMonotoneX);

//-----------------------------AXES-----------------------------//

// X Axis //
svg.append("g")
    .attr("id", "axis")
    .attr("transform", "translate(0," + svg_height + ")")
    .call(xaxis);

// Label for X Axis //
svg.append("text")
     .attr("id","x_axis_label")
     .attr("x" , 0 + svg_width / 2)
     .attr("y", svg_height + margins.bottom)
     .attr("text-anchor", "middle")
     .style("font-size", "14px")
     .attr("fill","black")
     .text("Month");

// Y Axis //
svg.append("g")
      .attr("id","y_axis")
     .attr("transform", "translate(0, 0)")
     .call(yaxis);

// Label for Y Axis //
svg.append("text")
     .attr("id","y_axis_label")
     .attr('transform', function(d , i){
      return 'translate(' + xScale(i) + ',' + svg_height/2 + ')';})
     .attr("x" , -svg_width / 4)
     .attr("y", -margins.left/2 - margins.right)
     .attr("text-anchor", "left")
     .style("font-size", "14px")
     .attr("fill","black")
     .text("Num of Ratings")
     .attr("transform", "rotate(-90)");

//Add Title
    svg.append("text")
       .attr("id","title")
     .attr("x", (svg_width / 2))
     .attr("y", (margins.top / 2))
     .attr("text-anchor", "middle")
     .style("font-size", "18px")
     .style("font-weight","bold")
     .text("Number of Ratings 2016-2020");

//----------------------------LINES-----------------------------//

// Choosing color category for the lines
var z = d3.scaleOrdinal(d3.schemeCategory10);
z.domain(columns_a.map(function(c) { return c.id; }));

var lines = svg.selectAll("lines")
    .data(columns_a)
    .enter()
    .append("g");

    lines.append("path")
    .attr("d", function(d) { return line(d.values); })
    .style("stroke", function(d) { return z(d.id); });

    lines.append("text")
    .attr("class","line_label")
    .datum(function(d) {
        return {
            id: d.id,
            value: d.values[d.values.length - 1]}; })
    .attr("transform", function(d) {
            return "translate(" + (xScale(d.value.date) + 1)
            + "," + (yScale(d.value.measurement) + 5 )+ ")"; })
    .attr("x", 3)
    .attr("y","0.15em")
    .attr("text-anchor", "start")
    .style("fill", function(d) { return z(d.id); })
    .text(function(d) { return d.id;});


  }).catch(function (error) {
      console.log(error);
    });

  </script>
</div>
<div class="pagebreak"> </div>


<div id="chart2">
  <script>


//---------------------------------------------------------------------------//
//---------------------------------------------------------------------------//
//-----------------------------   SECOND LINE CHART  -----------------------------//
//---------------------------------------------------------------------------//
//---------------------------------------------------------------------------//

var margins = {top: 30, right: 20, bottom: 30, left: 60}

var svg_width = 960 - margins.left - margins.right;
var svg_height = 500 - margins.top - margins.bottom;

var svg2 = d3.select("body").append("svg")
        .attr("width",svg_width + margins.left*3 + margins.right*3)
        .attr("height" , svg_height + margins.top + margins.bottom)
        .append('g')
        .attr('transform', 'translate(' + (margins.left) + ',' + margins.top + ')');


// GETTING THE DATA

var parseTime = d3.timeParse("%m/%d/%Y");
var formatTime = d3.timeFormat("%b %y");
var dataset = d3.csv("boardgame_ratings.csv");

dataset.then(function(data) {
    var slices = data.columns.slice(1).map(function(id) {
        return {
            id: id,
            values: data.map(function(d){
                return {
                    date: parseTime(d.date),
                    measurement: +d[id]
                };
            })
        };
    });


  // Keeping only the count columns
tokeep = ['Catan=count','Dominion=count','Codenames=count','Terraforming Mars=count','Gloomhaven=count','Magic: The Gathering=count','Dixit=count','Monopoly=count']
var columns_a = slices.filter(function(c){
  return tokeep.indexOf(c.id) >=0
});

    // Modifying the names to remove "=count" from the columns
columns_a.forEach(function(d) {
  d.id = d.id.substring(0,d.id.indexOf("="))
})

 //Keeping only the ranks in a separate dataset
tokeep_rank = ['Catan=rank','Dominion=rank','Codenames=rank','Terraforming Mars=rank','Gloomhaven=rank','Magic: The Gathering=rank','Dixit=rank','Monopoly=rank']
var columns_rank = slices.filter(function(c){
  return tokeep_rank.indexOf(c.id) >=0
});

    // Modifying the names to remove "=rank" from the columns
columns_rank.forEach(function(d) {
  d.id = d.id.substring(0,d.id.indexOf("="))
})




//----------------------------SCALES----------------------------//
var xScale = d3.scaleTime().range([0,svg_width]);
var yScale = d3.scaleLinear().rangeRound([svg_height, 0]);

xScale.domain(d3.extent(data, function(d){
    return parseTime(d.date)}));

yScale.domain([(0), d3.max(columns_a, function(c) {
    return d3.max(c.values, function(d) {
        return d.measurement ; });
        })
    ]);

//-----------------------------AXES-----------------------------//
var yaxis = d3.axisLeft()
    .scale(yScale);

var xaxis = d3.axisBottom()
    .tickFormat(d3.timeFormat("%b %y"))
    .scale(xScale);

//----------------------------LINES-----------------------------//
var line = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.measurement); })
    .curve(d3.curveMonotoneX);


//-----------------------------AXES-----------------------------//

// X Axis //
svg2.append("g")
    .attr("id", "axis")
    .attr("transform", "translate(0," + svg_height + ")")
    .call(xaxis);

// Label for X Axis //
svg2.append("text")
     .attr("id","x_axis_label")
     .attr("x" , 0 + svg_width / 2)
     .attr("y", svg_height + margins.bottom)
     .attr("text-anchor", "middle")
     .style("font-size", "14px")
     .attr("fill","black")
     .text("Month");

// Y Axis //
svg2.append("g")
      .attr("id","y_axis")
     .attr("transform", "translate(0, 0)")
     .call(yaxis);

// Label for Y Axis //
svg2.append("text")
     .attr("id","y_axis_label")
     .attr('transform', function(d , i){
      return 'translate(' + xScale(i) + ',' + svg_height/2 + ')';})
     .attr("x" , -svg_width / 4)
     .attr("y", -margins.left/2 - margins.right)
     .attr("text-anchor", "left")
     .style("font-size", "14px")
     .attr("fill","black")
     .text("Num of Ratings")
     .attr("transform", "rotate(-90)");

//Add Title
    svg2.append("text")
       .attr("id","title")
     .attr("x", (svg_width / 2))
     .attr("y", (margins.top / 2))
     .attr("text-anchor", "middle")
     .style("font-size", "18px")
     .style("font-weight","bold")
     .text("Number of Ratings 2016-2020 with Rankings");

//----------------------------LINES-----------------------------//

// Choosing color category for the lines
var z = d3.scaleOrdinal(d3.schemeCategory10);
z.domain(columns_a.map(function(c) { return c.id; }));

var lines = svg2.selectAll("lines")
    .data(columns_a)
    .enter()
    .append("g");

    lines.append("path")
    .attr("d", function(d) { return line(d.values); })
    .style("stroke", function(d) { return z(d.id); });

    lines.append("text")
    .attr("class","line_label")
    .datum(function(d) {
        return {
            id: d.id,
            value: d.values[d.values.length - 1]}; })
    .attr("transform", function(d) {
            return "translate(" + (xScale(d.value.date) + 1)
            + "," + (yScale(d.value.measurement) + 5 )+ ")"; })
    .attr("x", 3)
    .attr("y","0.15em")
    .attr("text-anchor", "start")
    .style("fill", function(d) { return z(d.id); })
    .text(function(d) { return d.id;});

  // ADDING RANKINGS TO THE CATEGORIES REQUESTED

var rank_data = data.map(function(dat){
    return {
        date: parseTime(dat.date),
        catan_count: +dat['Catan=count'],
        catan_rank: +dat["Catan=rank"],
        codenames_count: +dat["Codenames=count"],
        codenames_rank: +dat["Codenames=rank"],
        terraforming_count: +dat['Terraforming Mars=count'],
        terraforming_rank: +dat["Terraforming Mars=rank"],
        Gloomhaven_count: +dat['Gloomhaven=count'],
        Gloomhaven_rank: +dat["Gloomhaven=rank"]
    }
})
var format = d3.timeFormat("%b %y")

// Ranking for Catan group
svg2.selectAll(".dot1")
    .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
  .enter().append("circle")
    .attr("class", "dot1")
    .attr("cx", function(d) { return xScale(d.date) })
    .attr("cy", function(d) { return yScale(d.catan_count) })
    .attr("r", 10)
    .attr("fill",function(d) { return z("Catan"); })

svg2.append('g')
   .selectAll('text')
   .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
   .enter().append('text')
   .text(function(d){ return d.catan_rank})
   .attr("font-size",8)
   .attr('dx',function(d) { return xScale(d.date)-5 })
   .attr('dy',function(d) { return yScale(d.catan_count)+3 })
   .attr("fill","white")
   .style("font-weight","bold")

// Ranking for Codenames group
svg2.selectAll(".dot2")
    .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
  .enter().append("circle")
    .attr("class", "dot2")
    .attr("cx", function(d) { return xScale(d.date) })
    .attr("cy", function(d) { return yScale(d.codenames_count) })
    .attr("r", 10)
    .attr("fill",function(d) { return z("Codenames"); })

svg2.append('g')
   .selectAll('text')
   .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
   .enter().append('text')
   .text(function(d){ return d.codenames_rank})
   .attr("font-size",8)
   .attr('dx',function(d) { return xScale(d.date)-5 })
   .attr('dy',function(d) { return yScale(d.codenames_count)+3 })
   .attr("fill","white")
   .style("font-weight","bold")


// Ranking for Terraforming Mars group
svg2.selectAll(".dot3")
    .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
  .enter().append("circle")
    .attr("class", "dot3")
    .attr("cx", function(d) { return xScale(d.date) })
    .attr("cy", function(d) { return yScale(d.terraforming_count) })
    .attr("r", 10)
    .attr("fill",function(d) { return z("Terraforming Mars"); })

svg2.append('g')
   .selectAll('text')
   .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
   .enter().append('text')
   .text(function(d){ return d.terraforming_rank})
   .attr("font-size",8)
   .attr('dx',function(d) { return xScale(d.date)-5 })
   .attr('dy',function(d) { return yScale(d.terraforming_count)+3 })
   .attr("fill","white")
   .style("font-weight","bold")


// Ranking for Gloomhaven group
svg2.selectAll(".dot4")
    .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
  .enter().append("circle")
    .attr("class", "dot4")
    .attr("cx", function(d) { return xScale(d.date) })
    .attr("cy", function(d) { return yScale(d.Gloomhaven_count) })
    .attr("r", 10)
    .attr("fill",function(d) { return z("Gloomhaven"); })

svg2.append('g')
   .selectAll('text')
   .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
   .enter().append('text')
   .text(function(d){ return d.Gloomhaven_rank})
   .attr("font-size",8)
   .attr('dx',function(d) { return xScale(d.date)-5 })
   .attr('dy',function(d) { return yScale(d.Gloomhaven_count)+3 })
   .attr("fill","white")
   .style("font-weight","bold")

// Adding a Legend
var legend = svg2.selectAll('.legend')

legend.data(rank_data.filter(function(d){ return format(d.date) == 'Jan 17' })).enter().append("circle")
    .attr("class","legend")
    .attr("cx", svg_width + margins.right + margins.left)
    .attr("cy", svg_height -margins.top/2)
    .attr("r",12)
    .attr("fill","black")

svg2.append('text')
      .text("rank")
      .attr("font-size",8)
      .attr('dx',svg_width + margins.right + margins.left -8)
      .attr('dy',svg_height -margins.top/2.5)
      .attr("fill","white")
      .style("font-weight","bold")

svg2.append('text')
      .text("BoardGameGeek Rank")
      .attr("font-size",12)
      .attr('dx',svg_width + margins.right + margins.left/4)
      .attr('dy',svg_height +margins.top/3)
      .attr("fill","black")



}).catch(function (error) {
      console.log(error);
    });


 </script>
</div>
<div class="pagebreak"> </div>


<div id="chart3">
<script>

//---------------------------------------------------------------------------//
//---------------------------------------------------------------------------//
//-----------------------------   THIRD LINE CHART  -----------------------------//
//---------------------------------------------------------------------------//
//---------------------------------------------------------------------------//

var margins = {top: 30, right: 20, bottom: 30, left: 60}

var svg_width = 960 - margins.left - margins.right;
var svg_height = 500 - margins.top - margins.bottom;

var svg3 = d3.select("body").append("svg")
        .attr("width",svg_width + margins.left*3 + margins.right*3)
        .attr("height" , svg_height + margins.top + margins.bottom)
        .append('g')
        .attr('transform', 'translate(' + (margins.left) + ',' + margins.top + ')');


// GETTING THE DATA

var parseTime = d3.timeParse("%m/%d/%Y");
var formatTime = d3.timeFormat("%b %y");
var dataset = d3.csv("boardgame_ratings.csv");

dataset.then(function(data) {
    var slices = data.columns.slice(1).map(function(id) {
        return {
            id: id,
            values: data.map(function(d){
                return {
                    date: parseTime(d.date),
                    measurement: +d[id]
                };
            })
        };
    });


  // Keeping only the count columns
tokeep = ['Catan=count','Dominion=count','Codenames=count','Terraforming Mars=count','Gloomhaven=count','Magic: The Gathering=count','Dixit=count','Monopoly=count']
var columns_a = slices.filter(function(c){
  return tokeep.indexOf(c.id) >=0
});

    // Modifying the names to remove "=count" from the columns
columns_a.forEach(function(d) {
  d.id = d.id.substring(0,d.id.indexOf("="))
})

 //Keeping only the ranks in a separate dataset
tokeep_rank = ['Catan=rank','Dominion=rank','Codenames=rank','Terraforming Mars=rank','Gloomhaven=rank','Magic: The Gathering=rank','Dixit=rank','Monopoly=rank']
var columns_rank = slices.filter(function(c){
  return tokeep_rank.indexOf(c.id) >=0
});

    // Modifying the names to remove "=rank" from the columns
columns_rank.forEach(function(d) {
  d.id = d.id.substring(0,d.id.indexOf("="))
})




//----------------------------SCALES----------------------------//
var xScale = d3.scaleTime().range([0,svg_width]);
var yScale = d3.scaleSqrt().rangeRound([svg_height, 0]);

xScale.domain(d3.extent(data, function(d){
    return parseTime(d.date)}));

yScale.domain([(0), d3.max(columns_a, function(c) {
    return d3.max(c.values, function(d) {
        return d.measurement ; });
        })
    ]);

//-----------------------------AXES-----------------------------//
var yaxis = d3.axisLeft()
    .scale(yScale);

var xaxis = d3.axisBottom()
    .tickFormat(d3.timeFormat("%b %y"))
    .scale(xScale);

//----------------------------LINES-----------------------------//
var line = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.measurement); })
    .curve(d3.curveMonotoneX);


//-----------------------------AXES-----------------------------//

// X Axis //
svg3.append("g")
    .attr("id", "axis")
    .attr("transform", "translate(0," + svg_height + ")")
    .call(xaxis);

// Label for X Axis //
svg3.append("text")
     .attr("id","x_axis_label")
     .attr("x" , 0 + svg_width / 2)
     .attr("y", svg_height + margins.bottom)
     .attr("text-anchor", "middle")
     .style("font-size", "14px")
     .attr("fill","black")
     .text("Month");

// Y Axis //
svg3.append("g")
      .attr("id","y_axis")
     .attr("transform", "translate(0, 0)")
     .call(yaxis);

// Label for Y Axis //
svg3.append("text")
     .attr("id","y_axis_label")
     .attr('transform', function(d , i){
      return 'translate(' + xScale(i) + ',' + svg_height/2 + ')';})
     .attr("x" , -svg_width / 4)
     .attr("y", -margins.left/2 - margins.right)
     .attr("text-anchor", "left")
     .style("font-size", "14px")
     .attr("fill","black")
     .text("Num of Ratings")
     .attr("transform", "rotate(-90)");

//Add Title
    svg3.append("text")
       .attr("id","title")
     .attr("x", (svg_width / 2))
     .attr("y", (margins.top / 4))
     .attr("text-anchor", "middle")
     .style("font-size", "18px")
     .style("font-weight","bold")
     .text("Number of Ratings 2016-2020 (Square root Scale)");

//----------------------------LINES-----------------------------//

// Choosing color category for the lines
var z = d3.scaleOrdinal(d3.schemeCategory10);
z.domain(columns_a.map(function(c) { return c.id; }));

var lines = svg3.selectAll("lines")
    .data(columns_a)
    .enter()
    .append("g");

    lines.append("path")
    .attr("d", function(d) { return line(d.values); })
    .style("stroke", function(d) { return z(d.id); });

    lines.append("text")
    .attr("class","line_label")
    .datum(function(d) {
        return {
            id: d.id,
            value: d.values[d.values.length - 1]}; })
    .attr("transform", function(d) {
            return "translate(" + (xScale(d.value.date) + 1)
            + "," + (yScale(d.value.measurement) + 5 )+ ")"; })
    .attr("x", 3)
    .attr("y","0.15em")
    .attr("text-anchor", "start")
    .style("fill", function(d) { return z(d.id); })
    .text(function(d) { return d.id;});

  // ADDING RANKINGS TO THE CATEGORIES REQUESTED

var rank_data = data.map(function(dat){
    return {
        date: parseTime(dat.date),
        catan_count: +dat['Catan=count'],
        catan_rank: +dat["Catan=rank"],
        codenames_count: +dat["Codenames=count"],
        codenames_rank: +dat["Codenames=rank"],
        terraforming_count: +dat['Terraforming Mars=count'],
        terraforming_rank: +dat["Terraforming Mars=rank"],
        Gloomhaven_count: +dat['Gloomhaven=count'],
        Gloomhaven_rank: +dat["Gloomhaven=rank"]
    }
})
var format = d3.timeFormat("%b %y")

// Ranking for Catan group
svg3.selectAll(".dot1")
    .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
  .enter().append("circle")
    .attr("class", "dot1")
    .attr("cx", function(d) { return xScale(d.date) })
    .attr("cy", function(d) { return yScale(d.catan_count) })
    .attr("r", 10)
    .attr("fill",function(d) { return z("Catan"); })

svg3.append('g')
   .selectAll('text')
   .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
   .enter().append('text')
   .text(function(d){ return d.catan_rank})
   .attr("font-size",8)
   .attr('dx',function(d) { return xScale(d.date)-5 })
   .attr('dy',function(d) { return yScale(d.catan_count)+3 })
   .attr("fill","white")
   .style("font-weight","bold")

// Ranking for Codenames group
svg3.selectAll(".dot2")
    .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
  .enter().append("circle")
    .attr("class", "dot2")
    .attr("cx", function(d) { return xScale(d.date) })
    .attr("cy", function(d) { return yScale(d.codenames_count) })
    .attr("r", 10)
    .attr("fill",function(d) { return z("Codenames"); })

svg3.append('g')
   .selectAll('text')
   .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
   .enter().append('text')
   .text(function(d){ return d.codenames_rank})
   .attr("font-size",8)
   .attr('dx',function(d) { return xScale(d.date)-5 })
   .attr('dy',function(d) { return yScale(d.codenames_count)+3 })
   .attr("fill","white")
   .style("font-weight","bold")


// Ranking for Terraforming Mars group
svg3.selectAll(".dot3")
    .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
  .enter().append("circle")
    .attr("class", "dot3")
    .attr("cx", function(d) { return xScale(d.date) })
    .attr("cy", function(d) { return yScale(d.terraforming_count) })
    .attr("r", 10)
    .attr("fill",function(d) { return z("Terraforming Mars"); })

svg3.append('g')
   .selectAll('text')
   .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
   .enter().append('text')
   .text(function(d){ return d.terraforming_rank})
   .attr("font-size",8)
   .attr('dx',function(d) { return xScale(d.date)-5 })
   .attr('dy',function(d) { return yScale(d.terraforming_count)+3 })
   .attr("fill","white")
   .style("font-weight","bold")


// Ranking for Gloomhaven group
svg3.selectAll(".dot4")
    .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
  .enter().append("circle")
    .attr("class", "dot4")
    .attr("cx", function(d) { return xScale(d.date) })
    .attr("cy", function(d) { return yScale(d.Gloomhaven_count) })
    .attr("r", 10)
    .attr("fill",function(d) { return z("Gloomhaven"); })

svg3.append('g')
   .selectAll('text')
   .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
   .enter().append('text')
   .text(function(d){ return d.Gloomhaven_rank})
   .attr("font-size",8)
   .attr('dx',function(d) { return xScale(d.date)-5 })
   .attr('dy',function(d) { return yScale(d.Gloomhaven_count)+3 })
   .attr("fill","white")
   .style("font-weight","bold")

// Adding a Legend
var legend = svg3.selectAll('.legend')

legend.data(rank_data.filter(function(d){ return format(d.date) == 'Jan 17' })).enter().append("circle")
    .attr("class","legend")
    .attr("cx", svg_width + margins.right + margins.left)
    .attr("cy", svg_height -margins.top/2)
    .attr("r",12)
    .attr("fill","black")

svg3.append('text')
      .text("rank")
      .attr("font-size",8)
      .attr('dx',svg_width + margins.right + margins.left -8)
      .attr('dy',svg_height -margins.top/2.5)
      .attr("fill","white")
      .style("font-weight","bold")

svg3.append('text')
      .text("BoardGameGeek Rank")
      .attr("font-size",12)
      .attr('dx',svg_width + margins.right + margins.left/4)
      .attr('dy',svg_height +margins.top/3)
      .attr("fill","black")
      //.style("font-weight","bold")



  }).catch(function (error) {
      console.log(error);
    });


  </script>
</div>
<div class="pagebreak"> </div>



<div id="chart4">
<script>

//---------------------------------------------------------------------------//
//---------------------------------------------------------------------------//
//-----------------------------   FOURTH LINE CHART  -----------------------------//
//---------------------------------------------------------------------------//
//---------------------------------------------------------------------------//

var margins = {top: 30, right: 20, bottom: 30, left: 60}

var svg_width = 960 - margins.left - margins.right;
var svg_height = 500 - margins.top - margins.bottom;

var svg4 = d3.select("body").append("svg")
        .attr("width",svg_width + margins.left*3 + margins.right*3)
        .attr("height" , svg_height + margins.top + margins.bottom)
        .append('g')
        .attr('transform', 'translate(' + (margins.left) + ',' + margins.top + ')');


// GETTING THE DATA

var parseTime = d3.timeParse("%m/%d/%Y");
var formatTime = d3.timeFormat("%b %y");
var dataset = d3.csv("boardgame_ratings.csv");

dataset.then(function(data) {
    var slices = data.columns.slice(1).map(function(id) {
        return {
            id: id,
            values: data.map(function(d){
                return {
                    date: parseTime(d.date),
                    measurement: +d[id]
                };
            })
        };
    });


  // Keeping only the count columns
tokeep = ['Catan=count','Dominion=count','Codenames=count','Terraforming Mars=count','Gloomhaven=count','Magic: The Gathering=count','Dixit=count','Monopoly=count']
var columns_a = slices.filter(function(c){
  return tokeep.indexOf(c.id) >=0
});

    // Modifying the names to remove "=count" from the columns
columns_a.forEach(function(d) {
  d.id = d.id.substring(0,d.id.indexOf("="))
})

 //Keeping only the ranks in a separate dataset
tokeep_rank = ['Catan=rank','Dominion=rank','Codenames=rank','Terraforming Mars=rank','Gloomhaven=rank','Magic: The Gathering=rank','Dixit=rank','Monopoly=rank']
var columns_rank = slices.filter(function(c){
  return tokeep_rank.indexOf(c.id) >=0
});

    // Modifying the names to remove "=rank" from the columns
columns_rank.forEach(function(d) {
  d.id = d.id.substring(0,d.id.indexOf("="))
})




//----------------------------SCALES----------------------------//
var xScale = d3.scaleTime().range([0,svg_width]);
var yScale = d3.scaleLog().rangeRound([svg_height, 0]);

xScale.domain(d3.extent(data, function(d){
    return parseTime(d.date)}));

yScale.domain([1e-5,1e+5])

//-----------------------------AXES-----------------------------//
var yaxis = d3.axisLeft()
    .scale(yScale);

var xaxis = d3.axisBottom()
    .tickFormat(d3.timeFormat("%b %y"))
    .scale(xScale);

//----------------------------LINES-----------------------------//
var line = d3.line()
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.measurement); })
    .curve(d3.curveMonotoneX);


//-----------------------------AXES-----------------------------//

// X Axis //
svg4.append("g")
    .attr("id", "axis")
    .attr("transform", "translate(0," + svg_height + ")")
    .call(xaxis);

// Label for X Axis //
svg4.append("text")
     .attr("id","x_axis_label")
     .attr("x" , 0 + svg_width / 2)
     .attr("y", svg_height + margins.bottom)
     .attr("text-anchor", "middle")
     .style("font-size", "14px")
     .attr("fill","black")
     .text("Month");

// Y Axis //
svg4.append("g")
      .attr("id","y_axis")
     .attr("transform", "translate(0, 0)")
     .call(yaxis);

// Label for Y Axis //
svg4.append("text")
     .attr("id","y_axis_label")
     .attr('transform', function(d , i){
      return 'translate(' + xScale(i) + ',' + svg_height/2 + ')';})
     .attr("x" , -svg_width / 4)
     .attr("y", -margins.left/2 - margins.right)
     .attr("text-anchor", "left")
     .style("font-size", "14px")
     .attr("fill","black")
     .text("Num of Ratings")
     .attr("transform", "rotate(-90)");

//Add Title
    svg4.append("text")
       .attr("id","title")
     .attr("x", (svg_width / 2))
     .attr("y", (-margins.top / 4))
     .attr("text-anchor", "middle")
     .style("font-size", "18px")
     .style("font-weight","bold")
     .text("Number of Ratings 2016-2020 (Log Scale)");

//----------------------------LINES-----------------------------//

// Choosing color category for the lines
var z = d3.scaleOrdinal(d3.schemeCategory10);
z.domain(columns_a.map(function(c) { return c.id; }));

var lines = svg4.selectAll("lines")
    .data(columns_a)
    .enter()
    .append("g");

    lines.append("path")
    .attr("d", function(d) { return line(d.values); })
    .style("stroke", function(d) { return z(d.id); });

    lines.append("text")
    .attr("class","line_label")
    .datum(function(d) {
        return {
            id: d.id,
            value: d.values[d.values.length - 1]}; })
    .attr("transform", function(d) {
            return "translate(" + (xScale(d.value.date) + 1)
            + "," + (yScale(d.value.measurement) + 5 )+ ")"; })
    .attr("x", 3)
    .attr("y","0.15em")
    .attr("text-anchor", "start")
    .style("fill", function(d) { return z(d.id); })
    .text(function(d) { return d.id;});

  // ADDING RANKINGS TO THE CATEGORIES REQUESTED

var rank_data = data.map(function(dat){
    return {
        date: parseTime(dat.date),
        catan_count: +dat['Catan=count'],
        catan_rank: +dat["Catan=rank"],
        codenames_count: +dat["Codenames=count"],
        codenames_rank: +dat["Codenames=rank"],
        terraforming_count: +dat['Terraforming Mars=count'],
        terraforming_rank: +dat["Terraforming Mars=rank"],
        Gloomhaven_count: +dat['Gloomhaven=count'],
        Gloomhaven_rank: +dat["Gloomhaven=rank"]
    }
})
var format = d3.timeFormat("%b %y")

// Ranking for Catan group
svg4.selectAll(".dot1")
    .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
  .enter().append("circle")
    .attr("class", "dot1")
    .attr("cx", function(d) { return xScale(d.date) })
    .attr("cy", function(d) { return yScale(d.catan_count) })
    .attr("r", 10)
    .attr("fill",function(d) { return z("Catan"); })

svg4.append('g')
   .selectAll('text')
   .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
   .enter().append('text')
   .text(function(d){ return d.catan_rank})
   .attr("font-size",8)
   .attr('dx',function(d) { return xScale(d.date)-5 })
   .attr('dy',function(d) { return yScale(d.catan_count)+3 })
   .attr("fill","white")
   .style("font-weight","bold")

// Ranking for Codenames group
svg4.selectAll(".dot2")
    .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
  .enter().append("circle")
    .attr("class", "dot2")
    .attr("cx", function(d) { return xScale(d.date) })
    .attr("cy", function(d) { return yScale(d.codenames_count) })
    .attr("r", 10)
    .attr("fill",function(d) { return z("Codenames"); })

svg4.append('g')
   .selectAll('text')
   .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
   .enter().append('text')
   .text(function(d){ return d.codenames_rank})
   .attr("font-size",8)
   .attr('dx',function(d) { return xScale(d.date)-5 })
   .attr('dy',function(d) { return yScale(d.codenames_count)+3 })
   .attr("fill","white")
   .style("font-weight","bold")


// Ranking for Terraforming Mars group
svg4.selectAll(".dot3")
    .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
  .enter().append("circle")
    .attr("class", "dot3")
    .attr("cx", function(d) { return xScale(d.date) })
    .attr("cy", function(d) { return yScale(d.terraforming_count) })
    .attr("r", 10)
    .attr("fill",function(d) { return z("Terraforming Mars"); })

svg4.append('g')
   .selectAll('text')
   .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
   .enter().append('text')
   .text(function(d){ return d.terraforming_rank})
   .attr("font-size",8)
   .attr('dx',function(d) { return xScale(d.date)-5 })
   .attr('dy',function(d) { return yScale(d.terraforming_count)+3 })
   .attr("fill","white")
   .style("font-weight","bold")


// Ranking for Gloomhaven group
svg4.selectAll(".dot4")
    .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
  .enter().append("circle")
    .attr("class", "dot4")
    .attr("cx", function(d) { return xScale(d.date) })
    .attr("cy", function(d) { return yScale(d.Gloomhaven_count) })
    .attr("r", 10)
    .attr("fill",function(d) { return z("Gloomhaven"); })

svg4.append('g')
   .selectAll('text')
   .data(rank_data.filter(function (d){ return (format(d.date) == 'Jan 17' || format(d.date) == 'Apr 17' || format(d.date) == 'Jul 17' || format(d.date) == 'Oct 17' || format(d.date) == 'Jan 18' || format(d.date) == 'Apr 18' || format(d.date) == 'Jul 18' || format(d.date) == 'Oct 18' || format(d.date) == 'Jan 19' || format(d.date) == 'Apr 19' || format(d.date) == 'Jul 19' || format(d.date) == 'Oct 19'|| format(d.date) == 'Jan 20' || format(d.date) == 'Apr 20' || format(d.date) == 'Jul 20')}))
   .enter().append('text')
   .text(function(d){ return d.Gloomhaven_rank})
   .attr("font-size",8)
   .attr('dx',function(d) { return xScale(d.date)-5 })
   .attr('dy',function(d) { return yScale(d.Gloomhaven_count)+3 })
   .attr("fill","white")
   .style("font-weight","bold")

// Adding a Legend
var legend = svg4.selectAll('.legend')

legend.data(rank_data.filter(function(d){ return format(d.date) == 'Jan 17' })).enter().append("circle")
    .attr("class","legend")
    .attr("cx", svg_width + margins.right + margins.left)
    .attr("cy", svg_height -margins.top/2)
    .attr("r",12)
    .attr("fill","black")

svg4.append('text')
      .text("rank")
      .attr("font-size",8)
      .attr('dx',svg_width + margins.right + margins.left -8)
      .attr('dy',svg_height -margins.top/2.5)
      .attr("fill","white")
      .style("font-weight","bold")

svg4.append('text')
      .text("BoardGameGeek Rank")
      .attr("font-size",12)
      .attr('dx',svg_width + margins.right + margins.left/4)
      .attr('dy',svg_height +margins.top/3)
      .attr("fill","black")

svg4.append('text')
      .text("mganesan7")
      .attr("font-size",14)
      .attr('dx',svg_width + 2*margins.right + margins.left)
      .attr('dy',svg_height + 25)
      .attr("fill","black")


  }).catch(function (error) {
      console.log(error);
    });

  </script>
</div>



</body>

